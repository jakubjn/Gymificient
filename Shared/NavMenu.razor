@inject AuthenticationStateProvider authServiceProvider;

@* <div class="top-row ps-3 navbar navbar-dark">
     <div class="top-row-content">
         <a href=""><img class="main-logo" src="images/gymlogo2.png" /> </a>
     </div>

    <button title="Navigation menu" class="navbar-toggler" @onclick="ToggleNavMenu">
        <span class="navbar-toggler-icon"></span>
    </button>
</div>

<div class="@NavMenuCssClass nav-scrollable" @onclick="ToggleNavMenu">
    <nav class="d-flex flex-column" style="height: 80%">
        <div class="nav-item px-3">
            <NavLink class="nav-link" href="" Match="NavLinkMatch.All">
                <span aria-hidden="true"></span> Home
            </NavLink>
        </div>

        <div class="nav-item px-3">
            <NavLink class="nav-link" href="dashboard">
                <span aria-hidden="true"></span> Dashboard
            </NavLink>
        </div>

        <NavLink class="d-flex align-self-end" href="login" style="width:100%; justify-self: flex-end">
            <MudButton class="d-flex m-2 flex-row justify-content-start" style="width:90%">
                <MudAvatar Class="m-2 d-inline">

                </MudAvatar>

                <span style="color: #FFFFFF" class="d-inline">@userName</span>
            </MudButton>
        </NavLink>
    </nav>
</div> *@

<MudDrawerContainer Class="mud-height-full">
    <MudDrawer ClipMode="DrawerClipMode.Never" Breakpoint="Breakpoint.Sm" @bind-Open="@collapseNavMenu" Fixed="true" Elevation="1" Variant="@DrawerVariant.Mini" OpenMiniOnHover="true">
        <MudImage Style="height: 45px; width:40px; margin-left: 8px; margin-bottom: 20px" Src="Images/GymLogo.png" />

        <MudNavMenu>
            <MudNavLink Match="NavLinkMatch.All" Href="" Icon="@Icons.Material.Filled.Home">Home</MudNavLink>
            <MudNavLink Match="NavLinkMatch.All" Href="team" Icon="@Icons.Material.Filled.Badge">Team</MudNavLink>
            <MudNavLink Match="NavLinkMatch.All" Href="dashboard" Icon="@Icons.Material.Filled.Dashboard">Dashboard</MudNavLink>
        </MudNavMenu>
    </MudDrawer>
</MudDrawerContainer>

@code {
    private string userName;

    private bool collapseNavMenu = false;

    private string? NavMenuCssClass => collapseNavMenu ? "collapse" : null;

    private void ToggleNavMenu()
    {
        collapseNavMenu = !collapseNavMenu;
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        AuthorisationService authService = (AuthorisationService)authServiceProvider;

        UserSession userSession = await authService.GetUserSessionAsync();

        if (userSession is null)
        {
            userName = "Guest";
            return;
        }

        userName = userSession.UserName;
    }
}
